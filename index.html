<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Reflexos - Visual M√≠dia Leme</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Reset e configura√ß√µes b√°sicas */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-size: 1.5vw;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(45deg, #3b82f6, #f97316, #8b5cf6, #3b82f6);
            background-size: 300% 300%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            will-change: background-position;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Container principal otimizado */
        #app {
            width: 90vw;
            height: 90vh;
            max-width: 3840px;
            max-height: 2160px;
            position: relative;
            overflow: hidden;
            contain: strict;
        }
        
        /* Otimiza√ß√µes para o tabuleiro do jogo */
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5vw;
            width: 60vw;
            max-width: none;
            will-change: transform;
            transform: translateZ(0);
        }
        
        .square {
            aspect-ratio: 1/1;
            background-color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: all 0.15s ease-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            border-radius: 1vw;
            will-change: transform, background-color, box-shadow;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        .square.active {
            background-color: #3b82f6;
            transform: scale(0.95);
            box-shadow: 0 0 15px #3b82f6;
        }
        
        .square.wrong {
            background-color: #ef4444;
            transform: scale(0.95);
        }
        
        /* Efeitos otimizados */
        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(0.95); }
            20% { transform: translateX(-5px) scale(0.95); }
            40% { transform: translateX(5px) scale(0.95); }
            60% { transform: translateX(-5px) scale(0.95); }
            80% { transform: translateX(5px) scale(0.95); }
        }
        
        .shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* Efeito de vidro quebrando otimizado */
        .crack-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, transparent 48%, white 48%, white 52%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, white 48%, white 52%, transparent 52%);
            background-size: 100% 100%;
            animation: crack 0.6s ease-out forwards;
            pointer-events: none;
            mix-blend-mode: overlay;
            will-change: transform, opacity;
        }
        
        @keyframes crack {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1);
            }
            100% { 
                transform: scale(1.5) rotate(10deg);
                opacity: 0;
                filter: brightness(1.5);
            }
        }
        
        .flying-shard {
            position: absolute;
            background: white;
            opacity: 0.8;
            animation: flyShard 0.8s ease-out forwards;
            z-index: 10;
            will-change: transform, opacity;
        }
        
        @keyframes flyShard {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) scale(0);
                opacity: 0;
            }
        }
        
        /* Otimiza√ß√µes para o countdown */
        .countdown-container {
            position: relative;
            width: 10vw;
            height: 10vw;
            margin-bottom: 3vh;
            will-change: transform;
        }
        
        .countdown-svg {
            transform: rotate(-90deg);
            will-change: transform;
        }
        
        .countdown-circle-bg {
            stroke: #4b5563;
            stroke-width: 8;
            fill: none;
        }
        
        .countdown-circle {
            stroke: #3b82f6;
            stroke-width: 8;
            stroke-linecap: round;
            fill: none;
            transition: stroke-dashoffset 0.1s linear;
            will-change: stroke-dashoffset;
        }
        
        /* Otimiza√ß√µes para bot√µes */
        .pixel-btn {
            position: relative;
            border: 0.5vw solid #000;
            box-shadow: 0.5vw 0.5vw 0 rgba(0,0,0,0.2);
            transition: all 0.1s ease;
            font-size: 2vw;
            padding: 2vh 3vw;
            margin: 1vh 0;
            will-change: transform, box-shadow;
            transform: translateZ(0);
        }
        
        .pixel-btn:hover {
            transform: translate(0.3vw, 0.3vw);
            box-shadow: 0.3vw 0.3vw 0 rgba(0,0,0,0.2);
        }
        
        .pixel-btn:active {
            transform: translate(0.5vw, 0.5vw);
            box-shadow: none;
        }
        
        /* Otimiza√ß√µes para o ranking */
        #ranking-list {
            max-height: 40vh;
            overflow-y: auto;
            will-change: scroll-position;
        }
        
        .ranking-item {
            font-size: 1.8vw;
            padding: 1.5vh 1.5vw;
            margin: 1vh 0;
            will-change: transform;
        }
        
        /* Otimiza√ß√µes para part√≠culas */
        #particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            will-change: transform;
        }
        
        /* Esconde elementos n√£o vis√≠veis */
        [class*="screen"]:not(.active-screen) {
            display: none !important;
        }
        
        /* Classe para o screen ativo */
        .active-screen {
            display: flex !important;
        }
    </style>
</head>
<body>
    <div id="app" class="flex flex-col items-center justify-center p-4">
        <!-- Particle background simplificado -->
        <div id="particles" class="absolute inset-0 pointer-events-none"></div>
        
        <!-- Tela Inicial -->
        <div id="start-screen" class="flex flex-col items-center justify-center text-center w-full h-full relative z-10 active-screen">
            <div class="logo-container flex items-center justify-center bg-white/20 rounded-full backdrop-blur-sm border-2 border-white/30">
                <span class="text-8xl">üéÆ</span>
            </div>
            
            <h1 class="text-white">JOGO DE REFLEXOS</h1>
            <div class="space-y-4 w-full max-w-xl">
                <button id="start-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg pixel-btn">
                    JOGAR
                </button>
                <button id="ranking-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg pixel-btn">
                    RANKING
                </button>
            </div>
            <div class="absolute bottom-8 text-white/80 text-xl">
                Siga nosso Instagram: <span class="font-bold">@visualmidialeme</span>
            </div>
        </div>
        
        <!-- Tela do Jogo -->
        <div id="game-screen" class="hidden w-full h-full flex flex-col items-center justify-center relative z-10">
            <div class="countdown-container">
                <svg class="countdown-svg" width="100%" height="100%" viewBox="0 0 100 100">
                    <circle class="countdown-circle-bg" cx="50" cy="50" r="45"></circle>
                    <circle id="countdown-circle" class="countdown-circle" cx="50" cy="50" r="45"></circle>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center text-4xl font-bold">
                    <span id="time-left">20</span>
                </div>
            </div>
            
            <div class="mb-8 text-3xl font-bold">
                Pontos: <span id="score">0</span>
            </div>
            
            <div id="game-board" class="grid w-full">
                <!-- Squares will be generated by JavaScript -->
            </div>
        </div>
        
        <!-- Tela de Agradecimento -->
        <div id="thanks-screen" class="hidden w-full h-full flex flex-col items-center justify-center text-center px-8 relative z-10">
            <div class="bg-white/10 backdrop-blur-sm p-12 rounded-3xl border border-white/20 max-w-2xl w-full">
                <h2 class="font-bold mb-12">OBRIGADO POR JOGAR!</h2>
                
                <p class="text-3xl mb-12">Esperamos que tenha se divertido!</p>
                
                <div class="flex flex-col items-center space-y-6 mb-12">
                    <p class="text-2xl">Voc√™ j√° segue nosso Instagram?</p>
                    <div class="flex items-center space-x-4">
                        <span class="instagram-pixel"></span>
                        <span class="font-bold text-3xl">@visualmidialeme</span>
                    </div>
                </div>
                
                <button id="continue-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg pixel-btn w-full text-3xl py-6">
                    CONTINUAR PARA O RANKING
                </button>
            </div>
        </div>
        
        <!-- Tela de Cadastro de Nome -->
        <div id="name-screen" class="hidden w-full h-full flex flex-col items-center justify-center text-center px-8 relative z-10">
            <div class="bg-white/10 backdrop-blur-sm p-12 rounded-3xl border border-white/20 max-w-2xl w-full">
                <h2 class="font-bold mb-8">REGISTRE SEU NOME</h2>
                <p class="text-3xl mb-12">Sua pontua√ß√£o: <span id="final-score" class="font-bold text-blue-400">0</span></p>
                
                <div class="w-full mb-12">
                    <label for="player-name" class="block text-2xl mb-4">DIGITE SEU NOME:</label>
                    <input type="text" id="player-name" maxlength="20" class="w-full rounded-xl text-gray-800 text-center font-bold" placeholder="SEU NICK">
                </div>
                
                <button id="save-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg pixel-btn text-3xl py-6">
                    SALVAR E VER RANKING
                </button>
            </div>
        </div>
        
        <!-- Tela de Ranking -->
        <div id="ranking-screen" class="hidden w-full h-full flex flex-col items-center justify-start pt-16 px-8 relative z-10">
            <div class="bg-white/10 backdrop-blur-sm p-8 rounded-3xl border border-white/20 w-full max-w-4xl">
                <div class="ranking-title mb-12">
                    <h2 class="text-5xl font-bold text-yellow-400">RANKING</h2>
                </div>
                
                <div class="flex items-end justify-center space-x-8 mb-16 w-full">
                    <div class="flex flex-col items-center">
                        <div class="podium-2 w-32 rounded-t-2xl flex items-end justify-center pb-4">
                            <span class="text-4xl font-bold">2¬∫</span>
                        </div>
                        <div class="bg-gray-700/50 w-full py-4 rounded-b-2xl text-center">
                            <span id="second-place" class="block font-bold text-2xl truncate px-2 second-place-name">---</span>
                            <span id="second-score" class="text-xl player-score">0 pts</span>
                            <div class="mt-2 medal-silver text-4xl">ü•à</div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <div class="podium-1 w-40 rounded-t-2xl flex items-end justify-center pb-4">
                            <span class="text-4xl font-bold">1¬∫</span>
                        </div>
                        <div class="bg-gray-700/50 w-full py-4 rounded-b-2xl text-center">
                            <span id="first-place" class="block font-bold text-2xl truncate px-2 first-place-name">---</span>
                            <span id="first-score" class="text-xl player-score">0 pts</span>
                            <div class="mt-2 medal-gold text-4xl">ü•á</div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <div class="podium-3 w-32 rounded-t-2xl flex items-end justify-center pb-4">
                            <span class="text-4xl font-bold">3¬∫</span>
                        </div>
                        <div class="bg-gray-700/50 w-full py-4 rounded-b-2xl text-center">
                            <span id="third-place" class="block font-bold text-2xl truncate px-2 third-place-name">---</span>
                            <span id="third-score" class="text-xl player-score">0 pts</span>
                            <div class="mt-2 medal-bronze text-4xl">ü•â</div>
                        </div>
                    </div>
                </div>
                
                <div id="ranking-list" class="w-full space-y-4 mb-12">
                    <!-- Ranking items will be generated by JavaScript -->
                </div>
                
                <div id="current-player" class="w-full bg-blue-500/30 p-6 rounded-2xl mb-8 hidden">
                    <h3 class="font-bold mb-4 text-2xl">SUA POSI√á√ÉO:</h3>
                    <div id="player-position" class="text-3xl truncate"></div>
                </div>
                
                <button id="back-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg w-full pixel-btn text-3xl py-6">
                    VOLTAR AO IN√çCIO
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game state otimizado
        const gameState = {
            score: 0,
            timeLeft: 20,
            gameInterval: null,
            countdownInterval: null,
            activeSquares: [],
            isPlaying: false,
            currentPlayer: null,
            activeSquaresCount: 2,
            lastActivationTime: 0,
            activationDelay: 800
        };

        // Cache de elementos DOM
        const elements = {
            screens: {
                start: document.getElementById('start-screen'),
                game: document.getElementById('game-screen'),
                thanks: document.getElementById('thanks-screen'),
                name: document.getElementById('name-screen'),
                ranking: document.getElementById('ranking-screen')
            },
            buttons: {
                start: document.getElementById('start-btn'),
                ranking: document.getElementById('ranking-btn'),
                save: document.getElementById('save-btn'),
                back: document.getElementById('back-btn'),
                continue: document.getElementById('continue-btn')
            },
            game: {
                board: document.getElementById('game-board'),
                score: document.getElementById('score'),
                timeLeft: document.getElementById('time-left'),
                finalScore: document.getElementById('final-score'),
                playerName: document.getElementById('player-name'),
                countdownCircle: document.getElementById('countdown-circle'),
                particles: document.getElementById('particles')
            },
            ranking: {
                firstPlace: document.getElementById('first-place'),
                firstScore: document.getElementById('first-score'),
                secondPlace: document.getElementById('second-place'),
                secondScore: document.getElementById('second-score'),
                thirdPlace: document.getElementById('third-place'),
                thirdScore: document.getElementById('third-score'),
                list: document.getElementById('ranking-list'),
                currentPlayer: document.getElementById('current-player'),
                playerPosition: document.getElementById('player-position')
            }
        };

        // Inicializa√ß√£o otimizada
        function init() {
            createGameBoard();
            setupEventListeners();
            createParticles();
            
            // Pr√©-cria elementos de efeito
            preCreateEffects();
        }

        // Pr√©-cria elementos de efeito para reutiliza√ß√£o
        function preCreateEffects() {
            const effectsContainer = document.createElement('div');
            effectsContainer.id = 'effects-pool';
            effectsContainer.style.display = 'none';
            document.body.appendChild(effectsContainer);
            
            // Pr√©-cria 20 efeitos de crack
            for (let i = 0; i < 20; i++) {
                const crack = document.createElement('div');
                crack.className = 'crack-effect';
                effectsContainer.appendChild(crack);
            }
            
            // Pr√©-cria 50 shards
            for (let i = 0; i < 50; i++) {
                const shard = document.createElement('div');
                shard.className = 'flying-shard';
                effectsContainer.appendChild(shard);
            }
        }

        // Obt√©m um efeito crack do pool
        function getCrackEffect() {
            const pool = document.getElementById('effects-pool');
            const crack = pool.querySelector('.crack-effect');
            if (crack) {
                pool.removeChild(crack);
                return crack;
            }
            // Se n√£o tiver no pool, cria um novo (fallback)
            const newCrack = document.createElement('div');
            newCrack.className = 'crack-effect';
            return newCrack;
        }

        // Obt√©m um shard do pool
        function getShard() {
            const pool = document.getElementById('effects-pool');
            const shard = pool.querySelector('.flying-shard');
            if (shard) {
                pool.removeChild(shard);
                return shard;
            }
            // Se n√£o tiver no pool, cria um novo (fallback)
            const newShard = document.createElement('div');
            newShard.className = 'flying-shard';
            return newShard;
        }

        // Retorna um efeito para o pool
        function returnEffectToPool(effect) {
            const pool = document.getElementById('effects-pool');
            if (effect && pool) {
                effect.style.animation = 'none';
                effect.style.opacity = '0';
                effect.style.transform = 'scale(1)';
                pool.appendChild(effect);
            }
        }

        // Cria part√≠culas de fundo otimizadas
        function createParticles() {
            const particleCount = 30; // Reduzido para melhor performance
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'absolute rounded-full bg-white/10';
                
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                const duration = Math.random() * 20 + 10;
                const delay = Math.random() * 5;
                
                // Usando transform em vez de left/top para melhor performance
                particle.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)`;
                
                elements.game.particles.appendChild(particle);
            }
        }

        // Cria o tabuleiro do jogo otimizado
        function createGameBoard() {
            elements.game.board.innerHTML = '';
            const squareCount = 16;
            
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < squareCount; i++) {
                const square = document.createElement('div');
                square.className = 'square';
                square.dataset.index = i;
                square.addEventListener('click', handleSquareClick);
                fragment.appendChild(square);
            }
            
            elements.game.board.appendChild(fragment);
        }

        // Configura listeners de eventos otimizados
        function setupEventListeners() {
            elements.buttons.start.addEventListener('click', startGame);
            elements.buttons.ranking.addEventListener('click', showRanking);
            elements.buttons.save.addEventListener('click', saveScore);
            elements.buttons.back.addEventListener('click', showStartScreen);
            elements.buttons.continue.addEventListener('click', showNameScreen);
            
            // Touch events para melhor resposta em touchscreens
            elements.game.board.addEventListener('touchstart', function(e) {
                if (e.target.classList.contains('square')) {
                    handleSquareClick({ target: e.target });
                    e.preventDefault(); // Prevenir scroll
                }
            }, { passive: false });
        }

        // Inicia o jogo otimizado
        function startGame() {
            showScreen('game');
            resetGame();
            
            gameState.isPlaying = true;
            
            // Usa requestAnimationFrame para melhor sincroniza√ß√£o
            function gameLoop() {
                if (!gameState.isPlaying) return;
                
                const now = performance.now();
                if (now - gameState.lastActivationTime > gameState.activationDelay) {
                    activateRandomSquares();
                    gameState.lastActivationTime = now;
                }
                
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
            
            // Countdown otimizado
            const circumference = 2 * Math.PI * 45;
            elements.game.countdownCircle.style.strokeDasharray = circumference;
            elements.game.countdownCircle.style.strokeDashoffset = circumference;
            
            gameState.countdownInterval = setInterval(() => {
                gameState.timeLeft--;
                elements.game.timeLeft.textContent = gameState.timeLeft;
                
                const offset = circumference * (gameState.timeLeft / 20);
                elements.game.countdownCircle.style.strokeDashoffset = offset;
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.countdownInterval);
                    endGame();
                }
            }, 1000);
        }

        // Ativa quadrados aleat√≥rios otimizado
        function activateRandomSquares() {
            if (!gameState.isPlaying) return;
            
            const squares = elements.game.board.querySelectorAll('.square');
            const activeCount = gameState.activeSquares.length;
            
            // Limpa quadrados ativos que n√£o foram clicados
            squares.forEach((square, index) => {
                if (!gameState.activeSquares.includes(index) && square.classList.contains('active')) {
                    square.classList.remove('active');
                }
            });
            
            // Se j√° tem quadrados suficientes ativos, n√£o faz nada
            if (activeCount >= gameState.activeSquaresCount) return;
            
            // Ativa novos quadrados
            const inactiveSquares = Array.from(squares)
                .map((_, index) => index)
                .filter(index => !gameState.activeSquares.includes(index));
            
            if (inactiveSquares.length === 0) return;
            
            // Ativa at√© o n√∫mero m√°ximo de quadrados
            while (gameState.activeSquares.length < gameState.activeSquaresCount && inactiveSquares.length > 0) {
                const randomIndex = Math.floor(Math.random() * inactiveSquares.length);
                const squareIndex = inactiveSquares[randomIndex];
                
                squares[squareIndex].classList.add('active');
                gameState.activeSquares.push(squareIndex);
                
                // Remove do array de inativos
                inactiveSquares.splice(randomIndex, 1);
            }
        }

        // Manipulador de clique otimizado
        function handleSquareClick(e) {
            if (!gameState.isPlaying) return;
            
            const square = e.target;
            const index = parseInt(square.dataset.index);
            
            // Verifica se o quadrado est√° ativo
            if (gameState.activeSquares.includes(index)) {
                // Pontua√ß√£o
                gameState.score++;
                elements.game.score.textContent = gameState.score;
                
                // Remove classe ativa
                square.classList.remove('active');
                
                // Efeitos visuais otimizados
                applySquareEffects(square);
                
                // Remove do array de ativos
                const squareIndex = gameState.activeSquares.indexOf(index);
                if (squareIndex > -1) {
                    gameState.activeSquares.splice(squareIndex, 1);
                }
                
                // Aumenta dificuldade progressivamente
                if (gameState.score % 5 === 0 && gameState.activeSquaresCount < 4) {
                    gameState.activeSquaresCount++;
                }
            } else {
                // Feedback visual para erro
                square.classList.add('wrong');
                setTimeout(() => {
                    square.classList.remove('wrong');
                }, 300);
            }
        }

        // Aplica efeitos visuais otimizados
        function applySquareEffects(square) {
            // Efeito de crack
            const crack = getCrackEffect();
            square.appendChild(crack);
            
            // Efeito de shards
            createFlyingShards(square);
            
            // Anima√ß√£o de shake
            square.classList.add('shake');
            setTimeout(() => {
                square.classList.remove('shake');
                returnEffectToPool(crack);
            }, 300);
        }

        // Cria shards voadores otimizados
        function createFlyingShards(square) {
            const rect = square.getBoundingClientRect();
            const colors = ['#ffffff', '#e0f2fe', '#bfdbfe', '#93c5fd'];
            const shardCount = 8; // Quantidade fixa para melhor performance
            
            for (let i = 0; i < shardCount; i++) {
                const shard = getShard();
                
                const size = Math.random() * 20 + 10;
                const isRect = Math.random() > 0.5;
                
                if (isRect) {
                    shard.style.width = `${size}px`;
                    shard.style.height = `${size/2}px`;
                } else {
                    shard.style.width = `${size}px`;
                    shard.style.height = `${size}px`;
                    shard.style.borderRadius = '50%';
                }
                
                shard.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                const startX = Math.random() * rect.width;
                const startY = Math.random() * rect.height;
                
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 200 + 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                const rotation = Math.random() * 360;
                
                shard.style.setProperty('--tx', `${tx}px`);
                shard.style.setProperty('--ty', `${ty}px`);
                shard.style.setProperty('--rot', `${rotation}deg`);
                
                shard.style.left = `${startX}px`;
                shard.style.top = `${startY}px`;
                
                square.appendChild(shard);
                
                setTimeout(() => {
                    returnEffectToPool(shard);
                }, 800);
            }
        }

        // Finaliza o jogo otimizado
        function endGame() {
            gameState.isPlaying = false;
            clearInterval(gameState.countdownInterval);
            
            // Limpa quadrados ativos
            const squares = elements.game.board.querySelectorAll('.square');
            squares.forEach(square => {
                square.classList.remove('active', 'wrong');
            });
            
            gameState.activeSquares = [];
            
            showScreen('thanks');
        }

        // Mostra tela de nome
        function showNameScreen() {
            elements.game.finalScore.textContent = gameState.score;
            showScreen('name');
        }

        // Salva pontua√ß√£o otimizado
        function saveScore() {
            const name = elements.game.playerName.value.trim();
            if (!name) {
                alert('POR FAVOR, DIGITE SEU NOME!');
                return;
            }
            
            gameState.currentPlayer = {
                name: name.substring(0, 20).toUpperCase(),
                score: gameState.score
            };
            
            saveToLocalStorage(gameState.currentPlayer);
            showRanking();
        }

        // Salva no localStorage otimizado
        function saveToLocalStorage(player) {
            let ranking = JSON.parse(localStorage.getItem('reflexGameRanking')) || [];
            ranking.push(player);
            
            // Ordena apenas os novos elementos se poss√≠vel
            ranking.sort((a, b) => b.score - a.score);
            
            // Mant√©m apenas os top 50
            if (ranking.length > 50) {
                ranking = ranking.slice(0, 50);
            }
            
            localStorage.setItem('reflexGameRanking', JSON.stringify(ranking));
        }

        // Mostra ranking otimizado
        function showRanking() {
            showScreen('ranking');
            const ranking = JSON.parse(localStorage.getItem('reflexGameRanking')) || [];
            
            // Atualiza os 3 primeiros lugares
            if (ranking.length > 0) {
                elements.ranking.firstPlace.textContent = ranking[0].name;
                elements.ranking.firstScore.textContent = `${ranking[0].score} pts`;
            }
            
            if (ranking.length > 1) {
                elements.ranking.secondPlace.textContent = ranking[1].name;
                elements.ranking.secondScore.textContent = `${ranking[1].score} pts`;
            }
            
            if (ranking.length > 2) {
                elements.ranking.thirdPlace.textContent = ranking[2].name;
                elements.ranking.thirdScore.textContent = `${ranking[2].score} pts`;
            }
            
            // Atualiza a lista de ranking
            updateRankingList(ranking);
            
            // Mostra a posi√ß√£o do jogador atual se existir
            if (gameState.currentPlayer) {
                showCurrentPlayerPosition(ranking);
            }
        }

        // Atualiza a lista de ranking otimizada
        function updateRankingList(ranking) {
            const fragment = document.createDocumentFragment();
            
            for (let i = 3; i < Math.min(10, ranking.length); i++) {
                const player = ranking[i];
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-700/30 p-4 rounded-xl ranking-item';
                
                const position = document.createElement('div');
                position.className = 'player-position font-bold w-16 text-center';
                position.textContent = `${i+1}¬∫`;
                
                const name = document.createElement('div');
                name.className = 'player-name font-bold flex-1 px-4 truncate';
                name.textContent = player.name;
                
                const score = document.createElement('div');
                score.className = 'player-score w-24 text-right';
                score.textContent = `${player.score} pts`;
                
                item.appendChild(position);
                item.appendChild(name);
                item.appendChild(score);
                
                fragment.appendChild(item);
            }
            
            elements.ranking.list.innerHTML = '';
            elements.ranking.list.appendChild(fragment);
        }

        // Mostra posi√ß√£o do jogador atual
        function showCurrentPlayerPosition(ranking) {
            const playerIndex = ranking.findIndex(p => 
                p.name === gameState.currentPlayer.name && 
                p.score === gameState.currentPlayer.score
            );
            
            if (playerIndex !== -1) {
                elements.ranking.currentPlayer.classList.remove('hidden');
                
                let positionText = `${playerIndex + 1}¬∫`;
                if (playerIndex === 0) positionText = 'ü•á 1¬∫';
                else if (playerIndex === 1) positionText = 'ü•à 2¬∫';
                else if (playerIndex === 2) positionText = 'ü•â 3¬∫';
                
                elements.ranking.playerPosition.innerHTML = `
                    <span class="player-position">${positionText}</span> - 
                    <span class="current-player-name">${gameState.currentPlayer.name}</span>
                    (<span class="player-score">${gameState.currentPlayer.score} pts</span>)
                `;
            }
        }

        // Reseta o jogo
        function resetGame() {
            gameState.score = 0;
            gameState.timeLeft = 20;
            gameState.activeSquares = [];
            gameState.isPlaying = false;
            gameState.activeSquaresCount = 2;
            
            elements.game.score.textContent = '0';
            elements.game.timeLeft.textContent = '20';
            elements.game.playerName.value = '';
            
            const circumference = 2 * Math.PI * 45;
            elements.game.countdownCircle.style.strokeDasharray = circumference;
            elements.game.countdownCircle.style.strokeDashoffset = circumference;
        }

        // Mostra uma tela espec√≠fica
        function showScreen(screenName) {
            Object.values(elements.screens).forEach(screen => {
                screen.classList.remove('active-screen');
            });
            
            elements.screens[screenName].classList.add('active-screen');
        }

        // Mostra tela inicial
        function showStartScreen() {
            showScreen('start');
            resetGame();
        }

        // Inicializa o jogo quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
